# Metapopulation dynamics on networks

**Lesson plan**:

1. We analyze Levins' metapopulation model, which we've encountered before.
1. We introduce the idea of a network of dispersal, and see how metapopulation persistence depends on network structure.
1. We draw a parallel with Susceptible-Infected-Susceptible models, in which individuals play the role of habitable patches and parasites disperse on a network of contacts. 
1. Finally, we discuss recent extensions of metapopulation models including several complications.

## Metapopulations

In 1969, Richard Levins---then a professor at U. Chicago---proposed a simple model for a "metapopulation", i.e., a "population of populations in which local extinctions are balanced by remigration from other populations" (@levins1969some). 

:::boxhistory

**History: Richard Levins (1930-2016)**

```{r, echo=FALSE,out.width = "35%"}
knitr::include_graphics('img/Levins.jpg')
```

Born in Brooklyn, New York, he studied agriculture and mathematics at Cornell. Early on, influenced by geneticist and polymath Haldane, he became a Marxist activist. Upon graduation, having been blacklisted as a communist (and with the Korean War raging), he moved to Puerto Rico with his wife, and set up a farm. In his spare time, he conducted experiments on fruit flies, organized anti-colonialist rallies and anti-war protests, and taught at the University of Puerto Rico. In 1964, he was invited to Cuba to help organize the biology department of the University of Havana. He received his doctorate from Columbia University in 1965. In 1967 he moved to the University of Chicago, where he joined Richard Lewontin---whith whom he established a lifelong collaboration. They both moved to Harvard in 19XX.

It is impossible to summarize his numerous contributions to ecology, mathematics, political science, and the philosophy of science. He has inspired countless ecologists, and his approach and style are still visible in many of the research programs being carried out today. Of particular interest for this class, his theory of evolution in a changing environment (@levins1968evolution), the development of the idea of limiting similarity (@macarthur1967limiting), his work on metapopulation dynamics (@levins1969some), and the development of Loop Analysis (i.e., a qualitative theory for dynamical systems, @puccia2013qualitative).

:::

:::boxpaper

**Key paper: @levins1966strategy** 

A must read for anyone interested in modeling (in biology and elsewhere). Just two quotes that resonate with the approach taken in these lectures:

* *there are too many parameters to measure; some are still only vaguely defined; many would require a lifetime each for their measurement.*
* *The equations are insoluble analytically and exceed the capacity of even good computers,*
* *Even if soluble, the result expressed in the form of quotients of sums of products of parameters would have no meaning for us.*

$\ldots$

*Therefore, we attempt to treat the same problem with several alternative models each with different simplifications but with a common biological assumption. Then, if these models, despite their different assumptions, lead to similar results we have what we can call a robust theorem which is relatively free of the details of the model. Hence our  truth is the intersection of independent lies.*

:::

The model is very simple. Suppose that there are very many patches of suitable habitat, and that we track the proportion of patches occupied by a certain species, $x(t)$. Two processes affect the proportion of occupied patches: **extinction**, turning an occupied patch into a vacant patch, and **colonization**, turning a vacant patch into an occupied patch. For the simplest case, suppose that occupied patches can send "propagules" to empty patches at a fixed rate $\gamma$, and that the rate at which local populations go extinct is the same for all patches, $\delta$. 

Call $y(t) = 1 - x(t)$ the proportion of vacant patches. Then, the dynamics for the occupied patches are described by the equation:

$$
\dfrac{d x(t)}{dt} = - \delta x(t) + \gamma x(t) y(t)
$$

in which we assume mass-action (like in GLV). Similarly, the equation for the proportion of vacant patches is:

$$
\dfrac{d y(t)}{dt} = \delta x(t) - \gamma y(t) x(t) 
$$

Note that the two equations sum to zero (i.e., we're in a zero-sum setting), as $x(t) + y(t) = 1$. Then, we can turn the model into a single equation, by substituting $y(t) = 1 - x(t)$ in the first equation:

$$
\dfrac{d x(t)}{dt} = - \delta x(t) + \gamma x(t) (1-x(t)) = x(t)(\gamma - \delta - \gamma x(t))
$$

which is the usual equation for the logistic growth. As such, the equilibrium $x^\star = (\gamma - \delta) / \gamma = 1 - \delta/\gamma$ is globally stable.

Calling $S(t) = y(t)$ and $I(t) = x(t)$ we obtain an SIS model in which a pathogen infect ("occupies") individuals ("patches"). The equilibrium $I^\star = (\gamma - \delta)/\gamma$ is reached whenever $\gamma > \delta$ (i.e., $\gamma/\delta = \mathcal R_0 > 1$). We carry this parallel through the lecture.

## Hanski Ovaskainen 2000

Hanski and Ovaskainen: extension to geographic location of patches, kernel of dispersal.

Assumptions of the model

Leading eigenvalue and Perron eigenvector

:::boxhistory

**History: Ilkka A. Hanski (1953-2016)**

```{r, echo=FALSE,out.width = "35%"}
knitr::include_graphics('img/Hanski.gif')
```
*Photo by Otso Ovaskainen.*

Born in Lempäälä, Finland, he studied at the University of Helsinki, and received his doctorate from the University of Oxford in 1979. From 1981 to his premature death in 2016, he worked at various Finnish institutions, lastly at the Academy of Finland.

His work on metapopulation theory is extremely well-known, thanks also to the amazing work on the Glanville fritillary butterfly *Melitaea cinxia*. This butterfly inhabits the dry meadows in Åland Islands archipelago---with about 4000 meadows, sampled yearly by an army of students since 1991, the fragmented landscape is an ideal testing ground for metapopulation theory.

Hanski won numerous awards, and served as a strong advocate for ecological conservation.
:::

## SIS on a contact network

Interestingly, the same results above have been derived in the context of virus spread on networks by @van2008virus. We follow their derivation as it shows what type of approximations we're making when writing the equations above.

### The full model

We can imagine the process of spread of a pathogen on a network of $n$ individuals as a graph in which each node is a label detaling who is infected. There are $2^n$ nodes, ranging from $V_0 = 0,0, \ldots, 0$ (the state in which the pathogen is extinct) to $V_{2^n} = 1,1,\ldots, 1$ (the state in which all individuals are infected). Recovery flips a one into a zero, and infection a zero into a one (without loss of generality, we can assume only one event happens at each "time step"). We connect any two nodes in the network $V_i \to V_j$ if an event (i.e., infection, recovery) can send the system from state $i$ to state $j$. The system therefore describes a [Markov Chain](https://en.wikipedia.org/wiki/Markov_chain) with $2^n$ states. Note also that the state $0$ is the "coffin state" for the system (once the pathogen is extinct, there is no way to go back). 

### The mean-field approximation

For simplicity, make the following assumptions: a) all individuals have the same recovery rate, $\delta$; b) the (symmetric/undirected) contact network $A$ defines who can infect whom; c) when a node/individual is infected, it attempts infecting the neighbors at a rate $\beta$. 

We track the probability that individual $i$ is infected at time $t$ (mathematically, this is an expectation). In particular, take $x_i$ to be an indicator variable taking value $1$ when $i$ is infected, and $0$ when $i$ is susceptible. Then

$$
\dfrac{d E[x_i(t)]}{dt} = E \left[-\delta x_i(t) + \beta (1-x_i(t)) \sum_j A_{ij} E[x_j(t)]\right]
$$

The $-\delta x_i(t)$ models the recovery, and when an individual is susceptible (i.e., when $(1-x_i(t)) = 1$) the neighbors (i.e., $j$ such that $A_{ij} = 1$) attempt to infect node $i$. Expanding (and dropping the dependency on time to keep the equation compact), we obtain:

$$
\dfrac{d E[x_i]}{dt} = -\delta E[x_i] + \beta \sum_j A_{ij} E[x_j]- \beta \sum_j A_{ij} E[x_i x_j]
$$

which looks very much like Levins' model, with the difference that we need to choose how to deal with $E[x_i x_j]$ (a covariance/correlation). If we assume $E[x_i x_j] \approx E[x_i] E[x_j]$ (e.g., independence), we can simplify the model to:

$$
\dfrac{d E[x_i]}{dt} = -\delta E[x_i] + \beta (1 - E[x_i])\sum_j A_{ij} E[x_j]
$$

which is the same as the model of Hanski and Ovaskainen above. Interestingly, this is but an approximation of the full model described by the Markov Chain above---for example @cator2012second derive the model when tracking all the $E[x_i x_j]$, resulting in a better approximation of the full model (at the cost of having an additional $\binom{n}{2}$) equations.

## Metapopulations on randomly distributed patches

Grilli et al.

## [Optional] Ecosystem engineering and metapopulations

New work with Zach

Homework: Gillespie-based simulation using event-driven simulations.
Contrast approximation (NIMFA/Hanski-Ovaskainen)


